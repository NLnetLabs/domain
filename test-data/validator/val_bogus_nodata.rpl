do-ip6: no

; config options
server:
        stub-addr: 193.0.14.129
        trust-anchor: ".			IN DS 9352 8 2 14FBAADCF21A64138B28F41424812B0A2BDEEF443F5680D6CF337F72 B556998C "
	val-override-date: "20180823175219"
CONFIG_END

SCENARIO_BEGIN Test that bogus RRsets do not leak into SERVFAIL answers

RANGE_BEGIN 1 999999
	ADDRESS 193.0.14.129 ;k.root-servers.net
ENTRY_BEGIN
MATCH opcode qtype qname
ADJUST copy_id
REPLY QR RD RA AD NOERROR
SECTION QUESTION
.	IN	SOA
SECTION ANSWER
.                       86400   IN      SOA     a.root-servers.net. nstld.verisign-grs.com. 2017030902 1800 900 604800 86400
.                       86400   IN      RRSIG   SOA 8 0 86400 20180922145219 20180823145219 61125 . oUmzRZlxlk8WMI6EVAVqveSrD7gY7dxog/KF0xIsUgb4wuw7ysD4C1E7 GCKA8UqFXKsJn+RpKJHiHAASLctCL8Ewnger2ebeRtTNENEuqyvWlJwW HIY9Bk9YvMr5RzNdTfyLS+EGFGQzk2G793DOoi0DuNFaFK1AkN/jDDzD uGxwK/9oZ4X9Sk2mKeZfjKWIoXaPhMonfnWtX+6rKeMvgSjMZYEXz0+E XYHeHwvtUIPYzMfO2iCrEfCABH04OG61NP5N9W+IiOKP1KAmT8id3JyF JACHjSP6BeEIv6Ydzz3M9vq4B4pj0Cr9ePH0GnNC0Sg8uOfHzjC5bHld oaJs4g==
ENTRY_END

ENTRY_BEGIN
MATCH opcode qtype qname
ADJUST copy_id
REPLY QR RD RA AD NOERROR
SECTION QUESTION
.	IN	NS
SECTION ANSWER
.                       518400  IN      NS      k.root-servers.net.
.                       518400  IN      RRSIG   NS 8 0 518400 20180922145219 20180823145219 61125 . UKsrW4CGfH+NEKsm3fmOZJye/Z7OkLvzSOWT3awvZ8ZBDUTtC1Ah+JD1 Rm6+NJ7fRi+eXIpsI7Cp+rwYWPF44M7WDpVUjxVjsndIcQZhcMZ2p65p zBNgNbVZFvQ9Vl4SICIMp3Chx95B/hgfsDRdjba8+hzb5LI56ICErGws QOb8BjamTdSv3L3K5kCNPMed9xLlOat7njjH5jlrvmTecP1t6ObuEXML GCMBRorS8ICzoCErQE/0Zmya4tQOzBwobdeRvmLy48EtBd20YflIeTfu NvN9fE0WK57dB4MS+hi7Fkraw0JLBId13Ke+OGMLQQwGlGMw8vI+tpbI aWfKhQ==

ENTRY_END

ENTRY_BEGIN
MATCH opcode qtype qname
ADJUST copy_id
REPLY QR RD RA AD NOERROR
SECTION QUESTION
.	IN	DNSKEY
SECTION ANSWER
.                       3600000 IN      DNSKEY  256 3 8 AwEAAdTYhQKdlbsOqK0aFv0MllAAp1CCRr8p2eRjYjBvwonAudx2GtjN QJ0DubuKzZC1URUgYL0d3mwijsuWrlQMaI27hSNMK7nYAuDHtPsNp7ix 2TITCRTG4+yAPse8mX95qkynGxDL7VWRPBxdrzVpNzYgtKKwm1+7v1HT S0bhr0vEbQrg8ESblmdtSvwvHIasanH5ISL9XahixmW6AkTuFwHGZF1G hjzY+4wop0IOlGpim/kbyLDOs3bDhpOAB6OEddlq22zGBAK5pOc3XfzE 2emCyMXTLz6ElGO9H5/Yza3SK/BD13Wu+f6t5Ia2XBsC7GjdIAUkSL6J xtRWc3DvOVM=
.                       3600000 IN      DNSKEY  257 3 8 AwEAAaSG9FXnaJQp8BkrUzCV4TG4gbtanXZkcDFdNeIh3cKT3Kn0uElT 20W1Q4cQN2OM3rSrhkLCVa9bNGYWsleva4n7cdQFfTCMfu13EhtMVkeT /aylvhzqsiwtEDZHAb1J01CaQt25YeQCKuRvDIRbaGRvrw3P308X+rGD /eU1Oc9CMCVTX8Aqz/4g908yDNxTnM1PiU5CFNp5QgXnMive9MNcRyFE Yzb4U9YPRo/jOQGsqkqyWrFimGAYqWfjToKax4PuFiL4LSdevVMwoMLI gJ37fMHn1bnnq80FS93EBUcOD1uzeAkvleQwAd8/FarJAlK6mCCOaokt nu5x2m47E2U=
.                       2592000 IN      RRSIG   DNSKEY 8 0 3600 20180922145219 20180823145219 61125 . yYkUPTM8xs0TtYt1B6ch0puEzlVbzS2CENuBXBzGAg0TExiEtn8PPvsQ 4A6bWGg8Z4FXgs54d/mlGgSLdMQZgZQ+aNsALNqzyJ9J95SR+vOxWMqm 5+2zEn5cLmze1N6KbbbylMki7haLs9URqgM7Dt7QaT7k2zbqSqrNK64M El3Zz7wG7L0In1ZHIeSBWBXA7C9SMv7Nu+wGAiX6hR0GqTLByHdXm+J7 yfNIk3qpLTUz6c0Z7YZlwyIHF6eXHzRrdTZlU1m0M163RHQrxASDhBCz uNbbfdWp1hcG5AQ+XQNKoH7fg3yfYeHjPcTIrAmXnJdz0SnnqT6CYafr vm+9xw==
.                       2592000 IN      RRSIG   DNSKEY 8 0 3600 20180922145219 20180823145219 9352 . IqvhBDyacS6gSy4+tC1M07nBjlf7MU+41vE96fnyz3L3LcF7O1n71GWm MaB4fOzwFnTeUgTiW4egmj5HAxdYzBS00lyj0N2xALdmsG5r7rGdcjFR 5Lrwz/5xVw6ovoiYiocI+atIS1ZQuXnxQ8i+xwJGstHfoWjnw5+sY7xZ HBG1GZpJxL3pyKI5dFpC0K0wEtPgeFU/V4toA3sCejFjWeb4w7VPLKkH vhy7KoIEhcL5BZzDjBKGU5Oqp45zUo60Kogtquo+xTo8jZxTqKrU9XrX G1/hVquxJo5tDnM5YZK1Y5LZEciQalsalY+CYxpGE9TTiMS99vXGUiRc Sme0Fw==

ENTRY_END

ENTRY_BEGIN
MATCH opcode qtype qname
ADJUST copy_id
REPLY QR RD RA REFUSED
SECTION QUESTION
.	IN	RRSIG
SECTION ANSWER
ENTRY_END

ENTRY_BEGIN
MATCH opcode qtype qname
ADJUST copy_id
REPLY QR RD RA AD NOERROR
SECTION QUESTION
test.   IN      NS
SECTION ANSWER
test.   IN      NS      ns.net
ENTRY_END

ENTRY_BEGIN
MATCH opcode qtype qname
ADJUST copy_id
REPLY QR AA RD NOERROR
SECTION QUESTION
test.   IN      DS
SECTION AUTHORITY
.                       86400   IN      SOA     a.root-servers.net. nstld.verisign-grs.com. 2017030902 1800 900 604800 86400
test.                   86400   IN      NSEC    . NS RRSIG NSEC
.                       86400   IN      RRSIG   SOA 8 0 86400 20180922145219 20180823145219 61125 . oUmzRZlxlk8WMI6EVAVqveSrD7gY7dxog/KF0xIsUgb4wuw7ysD4C1E7 GCKA8UqFXKsJn+RpKJHiHAASLctCL8Ewnger2ebeRtTNENEuqyvWlJwW HIY9Bk9YvMr5RzNdTfyLS+EGFGQzk2G793DOoi0DuNFaFK1AkN/jDDzD uGxwK/9oZ4X9Sk2mKeZfjKWIoXaPhMonfnWtX+6rKeMvgSjMZYEXz0+E XYHeHwvtUIPYzMfO2iCrEfCABH04OG61NP5N9W+IiOKP1KAmT8id3JyF JACHjSP6BeEIv6Ydzz3M9vq4B4pj0Cr9ePH0GnNC0Sg8uOfHzjC5bHld oaJs4g==
test.                   86400   IN      RRSIG   NSEC 8 1 86400 20180922145219 20180823145219 61125 . Fgq94cQgkH4LhB0NFRSzqZT09eLTr4JdP+xV+s5HEPiipfmaRSy3Y1Zo ihtofwjO+LObPVLmyPz7WUWmJBCu3bPRS0GU4LtqYmpBpUxjuaVqbiw0 7/GO3IS6nLD1IVYpuXzktncdJDkwalkPb/qMtrMTSEzH5V6a9CJErKJR IEn36Ypg6+hvKXJT5uJyqcTseqFXnHDXBzIQjlc6rm7gPCdUCzxx9UrP SxVeNfLSYUV96RA2G1NgksCejP7TPpIiheRXDIItvl/XtQy5pdaPsdE+ bJHQaxC2uTabzvGPoLHRahfCjtH2XxuFsWCSm7ad0bRQH4v1o05CB8Cv 9JkDEQ==
ENTRY_END

ENTRY_BEGIN
MATCH opcode qtype qname
ADJUST copy_id
REPLY QR RD RA REFUSED
SECTION QUESTION
test.	IN	RRSIG
SECTION ANSWER
ENTRY_END

ENTRY_BEGIN
MATCH opcode qtype qname
ADJUST copy_id
REPLY QR RD RA AD NOERROR
SECTION QUESTION
net.   IN      NS
SECTION AUTHORITY
.                       86400   IN      SOA     a.root-servers.net. nstld.verisign-grs.com. 2017030902 1800 900 604800 86400
.                       86400   IN      RRSIG   SOA 8 0 86400 20180922145219 20180823145219 61125 . oUmzRZlxlk8WMI6EVAVqveSrD7gY7dxog/KF0xIsUgb4wuw7ysD4C1E7 GCKA8UqFXKsJn+RpKJHiHAASLctCL8Ewnger2ebeRtTNENEuqyvWlJwW HIY9Bk9YvMr5RzNdTfyLS+EGFGQzk2G793DOoi0DuNFaFK1AkN/jDDzD uGxwK/9oZ4X9Sk2mKeZfjKWIoXaPhMonfnWtX+6rKeMvgSjMZYEXz0+E XYHeHwvtUIPYzMfO2iCrEfCABH04OG61NP5N9W+IiOKP1KAmT8id3JyF JACHjSP6BeEIv6Ydzz3M9vq4B4pj0Cr9ePH0GnNC0Sg8uOfHzjC5bHld oaJs4g==
.                       86400   IN      NSEC    ns.net. NS SOA RRSIG NSEC DNSKEY
.                       86400   IN      RRSIG   NSEC 8 0 86400 20180922145219 20180823145219 61125 . LytyS0hCj2ICPHpIrXTjRNITmlSKgokGjR6ByELloAedBkJZ/wEbQPDO U6mJ4aS3b0gXawe6/OKbdLg38WpyUgfPVsKoGiiWDjAxq4/VBSnsSQec cr0jnBobqGGcskxGZGxIKmWOVR0lSiMNWxdlMhAiDIQRpZ3NZx57OmW/ zpI+sL1E1T0difRa2+qnPzmvJZ3k0m8VLHcavHv43SacLwfYkYmyyfTF itQQ8yxJ26atReXemFScOEZuVtkdWzBlHgzN8p5mZhzGc6lJEu51ncFI pJ9gLHAdSzxotyYpto73FW7siw2N7sQwcV0c9lIVhAa61yGSHfDza1jj p0CFDg==

ENTRY_END

ENTRY_BEGIN
MATCH opcode qtype qname
ADJUST copy_id
REPLY QR RD RA AD NOERROR
SECTION QUESTION
root-servers.net.   IN      NS
SECTION AUTHORITY
.                       86400   IN      SOA     a.root-servers.net. nstld.verisign-grs.com. 2017030902 1800 900 604800 86400
.                       86400   IN      RRSIG   SOA 8 0 86400 20180922145219 20180823145219 61125 . oUmzRZlxlk8WMI6EVAVqveSrD7gY7dxog/KF0xIsUgb4wuw7ysD4C1E7 GCKA8UqFXKsJn+RpKJHiHAASLctCL8Ewnger2ebeRtTNENEuqyvWlJwW HIY9Bk9YvMr5RzNdTfyLS+EGFGQzk2G793DOoi0DuNFaFK1AkN/jDDzD uGxwK/9oZ4X9Sk2mKeZfjKWIoXaPhMonfnWtX+6rKeMvgSjMZYEXz0+E XYHeHwvtUIPYzMfO2iCrEfCABH04OG61NP5N9W+IiOKP1KAmT8id3JyF JACHjSP6BeEIv6Ydzz3M9vq4B4pj0Cr9ePH0GnNC0Sg8uOfHzjC5bHld oaJs4g==
.                       86400   IN      NSEC    ns.net. NS SOA RRSIG NSEC DNSKEY
.                       86400   IN      RRSIG   NSEC 8 0 86400 20180922145219 20180823145219 61125 . LytyS0hCj2ICPHpIrXTjRNITmlSKgokGjR6ByELloAedBkJZ/wEbQPDO U6mJ4aS3b0gXawe6/OKbdLg38WpyUgfPVsKoGiiWDjAxq4/VBSnsSQec cr0jnBobqGGcskxGZGxIKmWOVR0lSiMNWxdlMhAiDIQRpZ3NZx57OmW/ zpI+sL1E1T0difRa2+qnPzmvJZ3k0m8VLHcavHv43SacLwfYkYmyyfTF itQQ8yxJ26atReXemFScOEZuVtkdWzBlHgzN8p5mZhzGc6lJEu51ncFI pJ9gLHAdSzxotyYpto73FW7siw2N7sQwcV0c9lIVhAa61yGSHfDza1jj p0CFDg==
ENTRY_END

ENTRY_BEGIN
MATCH opcode qtype qname
ADJUST copy_id
REPLY QR RD RA AD NOERROR
SECTION QUESTION
ns.net.   IN      A
SECTION ANSWER
ns.net.                 600     IN      A       1.1.1.1
ns.net.                 600     IN      RRSIG   A 8 2 600 20180922145219 20180823145219 61125 . lMTAJQzlIGSXxDXyx9v7D/sOblhpmaKEJocdracgxNdq139K1uY6nc7G mL0BOu4laDokHm2likkjkxd8zgMl9Q+4Py5prCS0nlxPSE1Rek7rGqGY DAx9nSyrpBY+MyMSlnaGEDEhBNKTZYnF6x5/aGs9u3TlqNI6nDB/00eP 8gXU4OoioARTQKvk7IHsbqjfwTlExbPbbT2Ojj0vJfGbLAsUmxfH8wmD ZO2psneD6JZW+fs1SIsxe/SpBn71j2kp9DDVFZVFmsMldlDHueKK/Drr D3bY0UQLlPgRLBiIAMFD6b8RxdxLKhSqYffFXDuJRpIWmVwF4LpdfrA/ IwPnng==

ENTRY_END

ENTRY_BEGIN
MATCH opcode qtype qname
ADJUST copy_id
REPLY QR RD RA AD NOERROR
SECTION QUESTION
k.root-servers.net.   IN      A
SECTION ANSWER
k.root-servers.net.     3600000 IN      A       193.0.14.129
k.root-servers.net.     2592000 IN      RRSIG   A 8 3 3600000 20180922145219 20180823145219 61125 . fp2r9FQp7w/05L5fnChzb4wtVbPOlzmCFINieJGTaB+0qrXoNpgWR9Uo gWgEiT+t6QyAEi4Ls2oUId+iJZPJ9xUV55ClpiWDEcr+/xLTrCQRgtih Z6bQS7xOaGMlX4ARWUEBEbWxQtcos1SEPDyWzay/b+/oS1+obuY6Q9H9 1/K6D1Dlu26Hxj6v7zk+h3g2oD3QNZk0OH1a0f7PndevNcF6BuqUHW9j 9MiUGXZbvM1pKK8ReCOgy7jsuhhnyCSqPTXJEZV7Ankygfg8hr4kLhOu Ek1siTIQFUgLoyCDS3JwX9i5Kunboksp04NYWKH2jqM/rsKyskT5mEJG Ab5vGQ==

ENTRY_END
RANGE_END

RANGE_BEGIN 1 999999
	ADDRESS 1.1.1.1 ;ns.net
ENTRY_BEGIN
MATCH opcode qtype qname
ADJUST copy_id
REPLY QR RD RA NOERROR
SECTION QUESTION
test.	IN	SOA
SECTION ANSWER
test.                       86400   IN      SOA     ns.net. hostmaster.example.com. 1234 1800 900 604800 86400
ENTRY_END

ENTRY_BEGIN
MATCH opcode qtype qname
ADJUST copy_id
REPLY QR RD RA NOERROR
SECTION QUESTION
test.   IN      NS
SECTION ANSWER
test.   IN      NS      ns.net
ENTRY_END

ENTRY_BEGIN
MATCH opcode qtype qname
ADJUST copy_id
REPLY QR RD RA NOERROR
SECTION QUESTION
ns.net.   IN      A
SECTION ANSWER
ns.net.			86400   IN      A     1.1.1.1
ENTRY_END
RANGE_END

; cache miss - wrong SOA RRSIG in answer section
STEP 101 QUERY
ENTRY_BEGIN
REPLY RD AD DO
SECTION QUESTION
.	IN	SOA
ENTRY_END

STEP 102 CHECK_ANSWER
ENTRY_BEGIN
MATCH all
REPLY QR RD RA SERVFAIL
SECTION QUESTION
.	IN	SOA
SECTION ANSWER
SECTION AUTHORITY
ENTRY_END

; cache hit - wrong SOA RRSIG in answer section
STEP 201 QUERY
ENTRY_BEGIN
REPLY RD AD DO
SECTION QUESTION
.	IN	SOA
ENTRY_END

STEP 202 CHECK_ANSWER
ENTRY_BEGIN
MATCH all
REPLY QR RD RA SERVFAIL
SECTION QUESTION
.	IN	SOA
SECTION ANSWER
SECTION AUTHORITY
ENTRY_END

; cache miss - wrong SOA RRSIG in authority section
STEP 301 QUERY
ENTRY_BEGIN
REPLY RD AD DO
SECTION QUESTION
test.	IN	DS
ENTRY_END

STEP 302 CHECK_ANSWER
ENTRY_BEGIN
MATCH all
REPLY QR AA RD SERVFAIL
SECTION QUESTION
test.	IN	DS
SECTION ANSWER
SECTION AUTHORITY
ENTRY_END

; cache hit - wrong SOA RRSIG in authority section
STEP 401 QUERY
ENTRY_BEGIN
REPLY RD AD DO
SECTION QUESTION
test.	IN	DS
ENTRY_END

STEP 402 CHECK_ANSWER
ENTRY_BEGIN
MATCH all
REPLY QR RD AA SERVFAIL
SECTION QUESTION
test.	IN	DS
SECTION ANSWER
SECTION AUTHORITY
ENTRY_END
SCENARIO_END
