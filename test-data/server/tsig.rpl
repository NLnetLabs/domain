;------------ Server configuration --------------------------------------------

server:
    ; Define an in-memory zone to be served by the server.
    local-data: "example.com.      3600  IN  SOA  ns.example.com. hostmaster.example.com. 1 3600 900 86400 3600"
    local-data: "example.com.      3600  IN  NS   ns.example.net."
    local-data: "www.example.com.  3600  IN  A    1.2.3.4"
CONFIG_END

;------------ Test definition ------------------------------------------------

SCENARIO_BEGIN Test TSIG signed SOA query receives correctly signed reply.

;--- Mock replies

; None

;--- Test steps

; NOTE: See test-data/server/README.md regarding the effect of MOCK_CLIENT
; that is used here.
STEP 10 QUERY
ENTRY_BEGIN
MATCH UDP
MATCH MOCK_CLIENT
SECTION QUESTION
    example.com.            IN  SOA
SECTION ADDITIONAL
; Stelline doesn't support parsing zone entries that use the ( multiline )
; format, otherwise we could use that here.
    TESTKEY           0     CLASS255  TYPE250  \# 61 0b686d61632d73686132353600 000000000000 012c 0020 a1c86ced1815d60903129a525a14494516895d99ea94bf0b5b04338126a4d625 0000 0000 0000
;                                                                                                                                                                                 ^ Other Len
;                                                                                                                                                                            ^ Error
;                                                                                                                                                                       ^ Original ID
;                                                                                                      ^ MAC
;                                                                                                 ^ MAC Size
;                                                                                            ^ Fudge
;                                                    ^ Algorithm Name           ^ Time Signed
;                                                 ^ RDATA byte length.
;                           ^ RFC 3597 CLASSNN TYPENN \# encoding of unknown DNS RR types.
;                             We use this so that we can define the RDATA using HEX bytes.
ENTRY_END

STEP 11 CHECK_ANSWER
ENTRY_BEGIN
MATCH all
REPLY QR NOERROR
SECTION QUESTION
    example.com.            IN  SOA
SECTION ANSWER
    example.com.      3600  IN  SOA  ns.example.com. hostmaster.example.com. 1 3600 900 86400 3600
SECTION ADDITIONAL
    TESTKEY           0     CLASS255  TYPE250  \# 61 0b686d61632d73686132353600 000000000000 012c 0020 6d7f9c5a14c2b48d4a0549000af29808e5eb25f7a80c22a2b1c0cf2ef3929bcd 0000 0000 0000
ENTRY_END

SCENARIO_END